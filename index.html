<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>OffenerHaushalt Bonn</title>
  <meta name="viewport" content="width=device-width">

  <link rel="stylesheet" href="css/bootstrap.css">
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
  
</head>
<body>
  <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->

  <div class="container">
    <h2 class='page-header'>Haushalt Bonn</h2>

    <div id='vis_widget' style='height: 400px;'></div>
    <div id='table_widget' style='height: 600px;'></div>
  </div>

  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/vendor/jquery.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/vendor/yepnope.min.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/vendor/underscore.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/vendor/backbone.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/vendor/bootstrap.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/boot.js"></script>
  <script defer="defer">OpenSpending.scriptRoot = "http://openspending.org/static/openspendingjs";</script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/utils/utils.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/lib/widgets.js"></script>
  <script type="text/javascript" src="http://openspending.org/static/openspendingjs/widgets/treemap/main.js"></script>
  <script type="text/javascript"
    src="http://openspending.org/static/openspendingjs/widgets/aggregate_table/main.js"></script>
  <script defer="defer">
    $(function() {
      var context = {
        dataset: "de-nrw-bonn",
        siteUrl: "http://openspending.org"
        };

      var WidgetLink = Backbone.Router.extend({
        routes: {
            "": "home",
            "produktbereich/:name": "produktbereich"
        },
        
        home: function(){
          var state = {
            year: 2014,
            drilldown: "produktbereich",
            drilldowns: ["produktbereich"],
            cuts: {
              art: "Aufwand"
            }
          };
          this.render(state, function(name) {
            app.navigate("produktbereich/" + name, {trigger: true});
          })
        },

        produktbereich: function(name) {
          console.log(name);
          var state = {
            year: 2014,
            drilldown: "produkt",
            drilldowns: ["produkt"],
            cuts: {
              produktbereich: name,
              art: "Aufwand"
            }
          };
          this.render(state, function(pname) {
            alert("Link zum BÃ¼rgerhaushalt, Produktbereich " + name + ", Produkt " + pname);
          })
        },

        render: function(state, callback) {
          var treemap_ctx = _.extend(context, {
            click: function(node) { callback(node.data.name); }
          });

          var treemap_dfd = new OpenSpending.Treemap($('#vis_widget'), treemap_ctx, state);
          var table_dfd = new OpenSpending.AggregateTable($('#table_widget'), context, state);
          $.when(treemap_dfd.promise(), table_dfd.promise()).then(function(w) {
            $('#table_widget').on('click', 'td a', function(e) {
              callback($(e.target).data('name'));
              return false;
            });
          });
        }
      });

      var app = new WidgetLink;
      Backbone.history.start();
    });
  </script>
</body>
</html>








